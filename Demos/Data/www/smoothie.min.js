(function(v){function l(c){this.options=n.extend({},l.defaultOptions,c);this.data=[];this.minValue=this.maxValue=Number.NaN}function e(c){this.options=n.extend({},e.defaultChartOptions,c);this.seriesSet=[];this.currentValueRange=1;this.currentVisMinValue=0}var n={extend:function(){arguments[0]=arguments[0]||{};for(var c=1;c<arguments.length;c++)for(var b in arguments[c])arguments[c].hasOwnProperty(b)&&(arguments[0][b]="object"===typeof arguments[c][b]?arguments[c][b]instanceof Array?arguments[c][b]:
n.extend(arguments[0][b],arguments[c][b]):arguments[c][b]);return arguments[0]}};l.defaultOptions={resetBoundsInterval:3E3,resetBounds:!0};l.prototype.resetBounds=function(){if(this.data.length){this.maxValue=this.data[0][1];this.minValue=this.data[0][1];for(var c=1;c<this.data.length;c++){var b=this.data[c][1];b>this.maxValue&&(this.maxValue=b);b<this.minValue&&(this.minValue=b)}}else this.minValue=this.maxValue=Number.NaN};l.prototype.append=function(c,b,a){for(var d=this.data.length-1;0<d&&this.data[d][0]>
c;)d--;0<this.data.length&&this.data[d][0]===c?a?(this.data[d][1]+=b,b=this.data[d][1]):this.data[d][1]=b:d<this.data.length-1?this.data.splice(d+1,0,[c,b]):this.data.push([c,b]);this.maxValue=isNaN(this.maxValue)?b:Math.max(this.maxValue,b);this.minValue=isNaN(this.minValue)?b:Math.min(this.minValue,b)};l.prototype.dropOldData=function(c,b){for(var a=0;this.data.length-a>=b&&this.data[a+1][0]<c;)a++;0!==a&&this.data.splice(0,a)};e.defaultChartOptions={millisPerPixel:20,maxValueScale:1,interpolation:"bezier",
scaleSmoothing:0.125,maxDataSetLength:2,grid:{fillStyle:"#000",strokeStyle:"#777",lineWidth:1,sharpLines:!1,millisPerLine:1E3,verticalSections:2,borderVisible:!0},labels:{fillStyle:"#fff",disabled:!1,fontSize:10,fontFamily:"monospace",precision:2},horizontalLines:[]};e.AnimateCompatibility=function(){var c=0;return{requestAnimationFrame:function(b,a){return(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||
function(a){var b=(new Date).getTime(),t=Math.max(0,16-(b-c)),e=window.setTimeout(function(){a(b+t)},t);c=b+t;return e}).call(window,b,a)},cancelAnimationFrame:function(b){return(window.cancelAnimationFrame||function(a){clearTimeout(a)}).call(window,b)}}}();e.defaultSeriesPresentationOptions={lineWidth:1,strokeStyle:"#fff"};e.prototype.addTimeSeries=function(c,b){this.seriesSet.push({timeSeries:c,options:n.extend({},e.defaultSeriesPresentationOptions,b)});c.options.resetBounds&&0<c.options.resetBoundsInterval&&
(c.resetBoundsTimerId=setInterval(function(){c.resetBounds()},c.options.resetBoundsInterval))};e.prototype.removeTimeSeries=function(c){for(var b=this.seriesSet.length,a=0;a<b;a++)if(this.seriesSet[a].timeSeries===c){this.seriesSet.splice(a,1);break}c.resetBoundsTimerId&&clearInterval(c.resetBoundsTimerId)};e.prototype.streamTo=function(c,b){this.canvas=c;this.delay=b;this.start()};e.prototype.start=function(){if(!this.frame){var c=function(){this.frame=e.AnimateCompatibility.requestAnimationFrame(function(){this.render();
c()}.bind(this))}.bind(this);c()}};e.prototype.stop=function(){this.frame&&(e.AnimateCompatibility.cancelAnimationFrame(this.frame),delete this.frame)};e.prototype.updateValueRange=function(){for(var c=this.options,b=Number.NaN,a=Number.NaN,d=0;d<this.seriesSet.length;d++){var f=this.seriesSet[d].timeSeries;isNaN(f.maxValue)||(b=isNaN(b)?f.maxValue:Math.max(b,f.maxValue));isNaN(f.minValue)||(a=isNaN(a)?f.minValue:Math.min(a,f.minValue))}b=null!=c.maxValue?c.maxValue:b*c.maxValueScale;null!=c.minValue&&
(a=c.minValue);this.options.yRangeFunction&&(b=this.options.yRangeFunction({min:a,max:b}),a=b.min,b=b.max);isNaN(b)||isNaN(a)||(this.currentValueRange+=c.scaleSmoothing*(b-a-this.currentValueRange),this.currentVisMinValue+=c.scaleSmoothing*(a-this.currentVisMinValue));this.valueRange={min:a,max:b}};e.prototype.render=function(c,b){c=c||this.canvas;b=b||(new Date).getTime()-(this.delay||0);b-=b%this.options.millisPerPixel;var a=c.getContext("2d"),d=this.options,f=c.clientWidth,e=c.clientHeight,l=b-
f*d.millisPerPixel,n=function(a){a-=this.currentVisMinValue;return 0===this.currentValueRange?e:e-Math.round(a/this.currentValueRange*e)}.bind(this);this.updateValueRange();a.font=d.labels.fontSize+"px "+d.labels.fontFamily;a.save();a.translate(0,0);a.beginPath();a.rect(0,0,f,e);a.clip();a.save();a.fillStyle=d.grid.fillStyle;a.clearRect(0,0,f,e);a.fillRect(0,0,f,e);a.restore();a.save();a.lineWidth=d.grid.lineWidth;a.strokeStyle=d.grid.strokeStyle;if(0<d.grid.millisPerLine)for(var k=f-a.measureText(k).width+
4,h=b-b%d.grid.millisPerLine;h>=l;h-=d.grid.millisPerLine){var g=Math.round(f-(b-h)/d.millisPerPixel);d.grid.sharpLines&&(g-=0.5);a.beginPath();a.moveTo(g,0);a.lineTo(g,e);a.stroke();a.closePath();if(d.timestampFormatter&&g<k){var m=d.timestampFormatter(new Date(h)),q=a.measureText(m).width,k=g-q-2;a.fillStyle=d.labels.fillStyle;a.fillText(m,g-q,e-2)}}for(k=1;k<d.grid.verticalSections;k++)h=Math.round(k*e/d.grid.verticalSections),d.grid.sharpLines&&(h-=0.5),a.beginPath(),a.moveTo(0,h),a.lineTo(f,
h),a.stroke(),a.closePath();d.grid.borderVisible&&(a.beginPath(),a.strokeRect(0,0,f,e),a.closePath());a.restore();if(d.horizontalLines&&d.horizontalLines.length)for(k=0;k<d.horizontalLines.length;k++)h=d.horizontalLines[k],g=Math.round(n(h.value))-0.5,a.strokeStyle=h.color||"#fff",a.lineWidth=h.lineWidth||1,a.beginPath(),a.moveTo(0,g),a.lineTo(f,g),a.stroke(),a.closePath();for(k=0;k<this.seriesSet.length;k++){a.save();m=this.seriesSet[k].timeSeries;h=m.data;g=this.seriesSet[k].options;m.dropOldData(l,
d.maxDataSetLength);a.lineWidth=g.lineWidth;a.strokeStyle=g.strokeStyle;a.beginPath();for(var u=q=m=0,r=0;r<h.length&&1!==h.length;r++){var p=Math.round(f-(b-h[r][0])/d.millisPerPixel),s=n(h[r][1]);if(0===r)m=p,a.moveTo(p,s);else switch(d.interpolation){case "linear":case "line":a.lineTo(p,s);break;default:a.bezierCurveTo(Math.round((q+p)/2),u,Math.round(q+p)/2,s,p,s)}q=p;u=s}1<h.length&&(g.fillStyle&&(a.lineTo(f+g.lineWidth+1,u),a.lineTo(f+g.lineWidth+1,e+g.lineWidth+1),a.lineTo(m,e+g.lineWidth),
a.fillStyle=g.fillStyle,a.fill()),g.strokeStyle&&"none"!==g.strokeStyle&&a.stroke(),a.closePath());a.restore()}if(!d.labels.disabled&&!isNaN(this.valueRange.min)&&!isNaN(this.valueRange.max)){var l=parseFloat(this.valueRange.max).toFixed(d.labels.precision),k=parseFloat(this.valueRange.min).toFixed(d.labels.precision);a.fillStyle=d.labels.fillStyle;a.fillText(l,f-a.measureText(l).width-2,d.labels.fontSize);a.fillText(k,f-a.measureText(k).width-2,e-2)}a.restore()};e.timeFormatter=function(c){function b(a){return(10>
a?"0":"")+a}return b(c.getHours())+":"+b(c.getMinutes())+":"+b(c.getSeconds())};v.TimeSeries=l;v.SmoothieChart=e})("undefined"===typeof exports?this:exports);